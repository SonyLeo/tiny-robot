import{d as U,p as T,h as x,c as d,q as J,o as r,e as C,b as z,a0 as F,n as B,F as A,B as D,k as u,H,af as X,G as I,j as v,t as M,w as ee,aB as W,aC as ae,x as te}from"./framework.DrGfhPAt.js";import{M as ie,H as O,j as Q,Z as V,Q as $,T as Y,N as G,Y as le,E,W as N,x as re,h as se,L as ne}from"./tiny-robot-svgs.BbDZZ-ON.js";import{s as S}from"./plugin-vue_export-helper.lGy7RumW.js";import{T as oe}from"./index.DEgDKdua.js";const j={image:G,pdf:Y,word:$,excel:V,ppt:Q,folder:O,other:ie},q=[{type:"image",matcher:a=>{var l,t;if(typeof a!="string")return((l=a.type)==null?void 0:l.startsWith("image/"))||!1;const p=((t=a.split(".").pop())==null?void 0:t.toLowerCase())||"";return["png","jpg","jpeg","gif","webp","bmp","svg"].includes(p)},icon:G},{type:"pdf",matcher:a=>typeof a!="string"?a.type==="application/pdf":a.toLowerCase().endsWith(".pdf"),icon:Y},{type:"word",matcher:a=>{var l;if(typeof a!="string")return a.type==="application/msword"||a.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document";const t=((l=a.split(".").pop())==null?void 0:l.toLowerCase())||"";return["doc","docx"].includes(t)},icon:$},{type:"excel",matcher:a=>{var l;if(typeof a!="string")return a.type==="application/vnd.ms-excel"||a.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";const t=((l=a.split(".").pop())==null?void 0:l.toLowerCase())||"";return["xls","xlsx"].includes(t)},icon:V},{type:"ppt",matcher:a=>{var l;if(typeof a!="string")return a.type==="application/vnd.ms-powerpoint"||a.type==="application/vnd.openxmlformats-officedocument.presentationml.presentation";const t=((l=a.split(".").pop())==null?void 0:l.toLowerCase())||"";return["ppt","pptx"].includes(t)},icon:Q},{type:"folder",matcher:a=>typeof a!="string"?!1:a.toLowerCase().endsWith("folder"),icon:O}];function K(a={}){const{customIcons:l,fileMatchers:t}=a,p=()=>{let e=[];return t?e=t.concat(q):e=q,e},o=(e="other")=>x(()=>{if(l!=null&&l[e])return l[e];const n=p().find(i=>i.type===e);return n!=null&&n.icon?n.icon:j[e]?j[e]:j.other}),m=e=>{const n=p();for(const i of n)if(i.matcher(e))return i.type;return"other"},g=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),b=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB",k=e=>typeof e.url=="string"&&!!e.url&&typeof e.size=="number",w=e=>e.rawFile instanceof File,c=e=>e.map(n=>{if(k(n))return f(n);if(w(n))return y(n)}),s=e=>({id:e.id||g(),name:e.name||"",status:e.status||"success",message:e.message||""}),f=e=>{const n=s(e),i=e.url,_=e.size,L=i.split("/").pop()||"";return{...n,name:n.name||L,fileType:m(L),size:_,url:i}},y=e=>{const n=s(e),i=e.rawFile;return{...n,name:n.name||i.name,fileType:m(i),rawFile:i,size:e.size||i.size,url:e.url}};return{detectFileType:m,generateID:g,formatFileSize:b,normalizeAttachments:c,getIconComponent:o}}const ce=(a,l)=>{if(a.startsWith("blob:")||a.startsWith("data:")){const t=document.createElement("a");t.href=a,t.download=l,document.body.appendChild(t),requestAnimationFrame(()=>{t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)})}};function de(a,l){const t=T([]),p=x(()=>a.file.fileType==="image"),o=c=>{const s=URL.createObjectURL(c);return t.value.push(s),s},m=c=>{l("preview",c,a.file)},g=c=>{if(l("download",c,a.file),!c.defaultPrevented&&a.file.rawFile&&!a.file.url){const s=o(a.file.rawFile);ce(s,a.file.name||a.file.rawFile.name)}},b=()=>{l("remove",a.file)},k=()=>{l("retry",a.file)},w=(c,s)=>{s.stopPropagation(),c.handler&&c.handler(a.file),c.type==="preview"?m(s):c.type==="download"?g(s):l("action",{action:c,file:a.file})};return te(()=>{t.value.forEach(c=>{URL.revokeObjectURL(c)}),t.value=[]}),{isImage:p,handlePreview:m,downloadFile:g,handleRemove:b,handleRetry:k,handleCustomAction:w}}const ue={class:"tr-image-preview__main"},fe=["disabled"],pe={class:"tr-image-preview__content"},ve=["src","alt"],me=["disabled"],_e={class:"tr-image-preview__footer"},ye={class:"tr-image-preview__thumbnails"},ge=["onClick"],he=["src","alt"],we=U({__name:"ImagePreview",props:W({images:{}},{currentIndex:{required:!0},currentIndexModifiers:{}}),emits:W(["close"],["update:currentIndex"]),setup(a,{emit:l}){const t=a,p=l,o=ae(a,"currentIndex"),m=x(()=>t.images[o.value]),g=()=>{o.value>0&&o.value--},b=()=>{o.value<t.images.length-1&&o.value++},k=c=>{o.value=c};function w(){p("close")}return(c,s)=>{var f,y;return r(),d("div",{class:"tr-image-preview",onClick:F(w,["self"])},[v("button",{class:"tr-image-preview__close",onClick:w},[I(u(re))]),v("div",ue,[v("button",{class:"tr-image-preview__nav tr-image-preview__nav--left",onClick:F(g,["stop"]),disabled:o.value===0},[I(u(se))],8,fe),v("div",pe,[v("img",{src:(f=m.value)==null?void 0:f.url,alt:(y=m.value)==null?void 0:y.name,class:"tr-image-preview__image"},null,8,ve)]),v("button",{class:"tr-image-preview__nav tr-image-preview__nav--right",onClick:F(b,["stop"]),disabled:o.value===c.images.length-1},[I(u(ne))],8,me)]),v("div",_e,[v("div",ye,[(r(!0),d(A,null,D(c.images,(e,n)=>(r(),d("div",{key:e.id,class:B(["tr-image-preview__thumbnail",{"tr-image-preview__thumbnail--active":n===o.value}]),onClick:i=>k(n)},[v("img",{src:e.url,alt:e.name},null,8,he)],10,ge))),128))])])])}}}),be=S(we,[["__scopeId","data-v-027af77c"]]);function ke(a,l,t={}){const p=T(!1),o=T([]),m=T(0),g=s=>{m.value=s},b=s=>{const f=a.value.findIndex(y=>y.id===s.id);if(f!==-1&&s.url&&a.value.splice(f,1,s),s.fileType==="image"){o.value=a.value.filter(e=>e.fileType==="image"&&e.status!=="error"&&e.status!=="uploading");const y=o.value.findIndex(e=>e.id===s.id);y!==-1&&(m.value=y,p.value=!0)}},k=(s,f)=>{l("preview",s,f),!s.defaultPrevented&&b(f)},w=()=>{p.value=!1},c=(s,f)=>{t.onDownload?t.onDownload(s,f):l("download",s,f)};return{handlePreview:k,renderPreview:()=>p.value?X(be,{images:o.value,currentIndex:m.value,"onUpdate:currentIndex":g,onClose:w,onDownload:c}):null}}function Ce(a,l){return{actualListType:x(()=>l&&l!=="auto"?l:a.value.length===0?"card":a.value.every(t=>t.fileType==="image")?"picture":"card")}}const xe=["data-file-type"],Ie={key:1,class:"tr-file-card__picture-container"},Me=["src","alt"],Fe={key:0,class:"tr-file-card__picture-overlay"},Le={key:1,class:"tr-file-card__status-overlay tr-file-card__status-overlay--picture"},Te={key:0,class:"tr-file-card__status-icon tr-file-card__status-icon--loading"},ze={key:0,class:"tr-file-card__status-icon--loading-text"},Be={key:2,class:"tr-file-card__default-container"},Pe={class:"tr-file-card__icon-wrapper"},Re={key:0,class:"tr-file-card__status-overlay tr-file-card__status-overlay--icon"},je={key:0,class:"tr-file-card__status-icon tr-file-card__status-icon--loading"},Ue={class:"tr-file-card__content"},Ae={class:"tr-file-card__info"},De=["title"],Se={key:0,class:"tr-file-card__status"},We={key:0,class:"tr-file-card__status-success"},Ee={class:"tr-file-card__status-info"},Ne={class:"tr-file-card__file-type"},qe={key:0,class:"tr-file-card__file-size"},He={key:0,class:"tr-file-card__actions"},Oe=["href","target","onClick"],Qe=["onClick"],Ve={key:1,class:"tr-file-card__status-uploading"},$e={key:2,class:"tr-file-card__status-error"},Ye=U({__name:"FileCard",props:{file:{},variant:{default:"card"},showStatus:{type:Boolean,default:!0},fileIcons:{},disabled:{type:Boolean},actions:{},fileMatchers:{}},emits:["remove","preview","action","retry","download"],setup(a,{emit:l}){const t=a,p=l,{formatFileSize:o,getIconComponent:m}=K({customIcons:t.fileIcons,fileMatchers:t.fileMatchers}),{isImage:g,handlePreview:b,handleRemove:k,handleCustomAction:w,handleRetry:c}=de(t,p),s=x(()=>m(t.file.fileType).value),f=x(()=>t.file.status==="uploading"),y=x(()=>t.file.status==="success"),e=x(()=>t.file.status==="error"),n=x(()=>[t.variant==="picture"?"tr-file-card--picture":"tr-file-card",`tr-file-card--${t.file.fileType||"other"}`,{"tr-file-card--uploading":f.value,"tr-file-card--error":e.value,"tr-file-card--success":y.value}]);return(i,_)=>{var L;return r(),d("div",{class:B(n.value),"data-file-type":i.file.fileType||"other",onClick:_[3]||(_[3]=h=>i.variant==="picture"?u(b)(h):void 0)},[i.disabled?C("",!0):(r(),d("button",{key:0,class:"tr-file-card__close-btn",onClick:_[0]||(_[0]=F((...h)=>u(k)&&u(k)(...h),["stop"])),"aria-label":"移除文件"},[I(u(le))])),i.variant==="picture"?(r(),d("div",Ie,[v("img",{src:i.file.url,alt:i.file.name,class:"tr-file-card__picture-img"},null,8,Me),y.value?(r(),d("div",Fe,[..._[4]||(_[4]=[v("span",{class:"tr-file-card__picture-overlay-text"},"预览",-1)])])):C("",!0),f.value||e.value?(r(),d("div",Le,[f.value?(r(),d("div",Te,[I(u(E)),i.file.message?(r(),d("span",ze,M(i.file.message),1)):C("",!0)])):e.value?(r(),z(u(oe),{key:1,content:"解析失败",placement:"top",effect:"light"},{default:ee(()=>[I(u(N),{class:"tr-file-card__status-icon tr-file-card__status-icon--error"})]),_:1})):C("",!0)])):C("",!0)])):(r(),d("div",Be,[v("div",{class:B(["tr-file-card__icon",{"tr-file-card__icon--clickable":u(g)}]),onClick:_[1]||(_[1]=F(h=>u(g)?u(b)(h):null,["stop"]))},[v("div",Pe,[(r(),z(H(s.value),{class:"tr-file-card__file-icon"})),f.value||e.value?(r(),d("div",Re,[f.value?(r(),d("div",je,[I(u(E))])):e.value?(r(),z(u(N),{key:1,class:"tr-file-card__status-icon tr-file-card__status-icon--error"})):C("",!0)])):C("",!0)])],2),v("div",Ue,[v("div",Ae,[v("div",{class:"tr-file-card__name",title:i.file.name},M(i.file.name),9,De),i.showStatus?(r(),d("div",Se,[y.value?(r(),d("div",We,[v("div",Ee,[v("span",Ne,M(((L=i.file.fileType)==null?void 0:L.toUpperCase())||"FILE"),1),i.file.size?(r(),d("span",qe,M(u(o)(i.file.size)),1)):C("",!0)]),i.actions?(r(),d("div",He,[(r(!0),d(A,null,D(i.actions,(h,Z)=>(r(),d("div",{key:Z,class:"tr-file-card__action-btn"},[h.type==="download"?(r(),d("a",{key:0,class:"tr-file-card__action-btn--download",href:i.file.url??"javascript:void(0)",target:i.file.url?"_blank":"_self",onClick:R=>u(w)(h,R)},M(h.label),9,Oe)):(r(),d("button",{key:1,class:B(`tr-file-card__action-btn--${h.type}`),onClick:R=>u(w)(h,R)},M(h.label),11,Qe))]))),128))])):C("",!0)])):f.value?(r(),d("div",Ve,[..._[5]||(_[5]=[v("span",{class:"tr-file-card__uploading-text"},"上传中...",-1)])])):e.value?(r(),d("div",$e,[_[6]||(_[6]=v("span",{class:"tr-file-card__error-text"},"上传失败",-1)),v("button",{class:"tr-file-card__retry-btn",onClick:_[2]||(_[2]=(...h)=>u(c)&&u(c)(...h))},"重试")])):C("",!0)])):C("",!0)])])]))],10,xe)}}}),Ge=S(Ye,[["__scopeId","data-v-a569c028"]]),Ke={class:"tr-attachments"},Ze=U({__name:"index",props:{items:{},disabled:{type:Boolean},wrap:{type:Boolean},fileIcons:{},actions:{default:()=>[{label:"下载",type:"download"},{label:"预览",type:"preview"}]},variant:{default:"auto"},fileMatchers:{default:()=>[]}},emits:["update:items","remove","download","retry","preview","action"],setup(a,{emit:l}){const t=a,p=l,o=T(t.items||[]),{actualListType:m}=Ce(o,t.variant),{handlePreview:g,renderPreview:b}=ke(o,p,{enableDownload:!0});function k(e){if(t.disabled)return;const n=o.value.findIndex(i=>i.id===e.id);n!==-1&&(o.value.splice(n,1),p("remove",e),p("update:items",o.value))}function w(e,n){p("download",e,n)}function c(e){p("retry",e)}function s(e){p("action",e)}const f=x(()=>t.wrap?"wrap":"no-wrap"),{normalizeAttachments:y}=K({fileMatchers:t.fileMatchers});return J(()=>t.items,e=>{e&&e.length>0&&(o.value=y(e))},{deep:!0,immediate:!0}),(e,n)=>(r(),d("div",Ke,[o.value.length>0?(r(),d("div",{key:0,class:B(["tr-attachments__file-list",f.value]),onClick:n[0]||(n[0]=F(()=>{},["stop"]))},[(r(!0),d(A,null,D(o.value,i=>(r(),z(Ge,{key:i.id,file:i,variant:u(m),"file-icons":e.fileIcons,disabled:e.disabled,actions:e.actions,"show-status":!0,"file-matchers":e.fileMatchers,onRemove:k,onPreview:u(g),onDownload:w,onRetry:c,onAction:s},null,8,["file","variant","file-icons","disabled","actions","file-matchers","onPreview"]))),128))],2)):C("",!0),(r(),z(H(u(b)())))]))}}),P=S(Ze,[["__scopeId","data-v-e09559ac"]]);P.name="TrAttachments";const Je=function(a){a.component(P.name,P)};P.install=Je;export{P as $};
