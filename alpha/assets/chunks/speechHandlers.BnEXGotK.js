import{D as $e}from"./theme.C_-hLVRq.js";var Ge={exports:{}};(function(Z){(function(v){var c=typeof window=="object"&&!!window.document,x=c?window:Object;v(x,c),Z.exports&&(Z.exports=x.Recorder)})(function(v,c){var x=function(){},I=function(t){return typeof t=="number"},R=function(t){return JSON.stringify(t)},s=function(t){return new Ie(t)},u=s.LM="2025-01-11 09:28",T="https://github.com/xiangyuecn/Recorder",C="Recorder",O="getUserMedia",re="srcSampleRate",j="sampleRate",pe="bitRate",ue="catch",ae=v[C];if(ae&&ae.LM==u){ae.CLog(ae.i18n.$T("K8zP::重复导入{1}",0,C),3);return}s.IsOpen=function(){var t=s.Stream;if(t){var r=ke(t),e=r[0];if(e){var n=e.readyState;return n=="live"||n==e.LIVE}}return!1},s.BufferSize=4096,s.Destroy=function(){G(C+" Destroy"),_e();for(var t in we)we[t]()};var we={};s.BindDestroy=function(t,r){we[t]=r},s.Support=function(){if(!c)return!1;var t=navigator.mediaDevices||{};return t[O]||(t=navigator,t[O]||(t[O]=t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia)),!(!t[O]||(s.Scope=t,!s.GetContext()))},s.GetContext=function(t){if(!c)return null;var r=window.AudioContext;if(r||(r=window.webkitAudioContext),!r)return null;var e=s.Ctx,n=0;return e||(e=s.Ctx=new r,n=1,s.NewCtxs=s.NewCtxs||[],s.BindDestroy("Ctx",function(){var a=s.Ctx;a&&a.close&&(ie(a),s.Ctx=0);var o=s.NewCtxs;s.NewCtxs=[];for(var i=0;i<o.length;i++)ie(o[i])})),t&&e.close&&(n||(e._useC||ie(e),e=new r),e._useC=1,s.NewCtxs.push(e)),e},s.CloseNewCtx=function(t){if(t&&t.close){ie(t);for(var r=s.NewCtxs||[],e=r.length,n=0;n<r.length;n++)if(r[n]==t){r.splice(n,1);break}G(f("mSxV::剩{1}个GetContext未close",0,e+"-1="+r.length),r.length?3:0)}};var ie=function(t){if(t&&t.close&&!t._isC&&(t._isC=1,t.state!="closed"))try{t.close()}catch(r){G("ctx close err",1,r)}},le=s.ResumeCtx=function(t,r,e,n){var a=0,o=0,i=0,w=0,l="EventListener",h="ResumeCtx ",M=function(S,d){o&&K(),a||(a=1,S&&n(S,w),d&&e(w)),d&&(!t._LsSC&&t["add"+l]&&t["add"+l]("statechange",y),t._LsSC=1,i=1)},K=function(S){if(!(S&&o)){o=S?1:0;for(var d=["focus","mousedown","mouseup","touchstart","touchend"],P=0;P<d.length;P++)window[(S?"add":"remove")+l](d[P],y,!0)}},y=function(){var S=t.state,d=se(S);if(!a&&!r(d?++w:w))return M();d?(i&&G(h+"sc "+S,3),K(1),t.resume().then(function(){i&&G(h+"sc "+t.state),M(0,1)})[ue](function(P){G(h+"error",1,P),se(t.state)||M(P.message||"error")})):S=="closed"?(i&&!t._isC&&G(h+"sc "+S,1),M("ctx closed")):M(0,1)};y()},se=s.CtxSpEnd=function(t){return t=="suspended"||t=="interrupted"},ye=function(t){var r=t.state,e="ctx.state="+r;return se(r)&&(e+=f("nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）")),e},Ce="ConnectEnableWebM";s[Ce]=!0;var ve="ConnectEnableWorklet";s[ve]=!1;var xe=function(t){var r=t.BufferSize||s.BufferSize,e=t.Stream,n=e._c,a=n[j],o={},i=ke(e),w=i[0],l=null,h="";if(w&&w.getSettings){l=w.getSettings();var M=l[j];M&&M!=a&&(h=f("eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，",0,M,a))}e._ts=l,G(h+"Stream TrackSet: "+R(l),h?3:0);var K=function(E){var D=e._m=n.createMediaStreamSource(e),N=n.destination,V="createMediaStreamDestination";n[V]&&(N=e._d=n[V]()),D.connect(E),E.connect(N)},y,S,d,P="",z=e._call,_=function(E,D){for(var N in z){if(D!=a){o.index=0,o=s.SampleData([E],D,a,o,{_sum:1});var V=o.data,F=o._sum}else{o={};for(var U=E.length,V=new Int16Array(U),F=0,Q=0;Q<U;Q++){var J=Math.max(-1,Math.min(1,E[Q]));J=J<0?J*32768:J*32767,V[Q]=J,F+=Math.abs(J)}}for(var X in z)z[X](V,F);return}},g="ScriptProcessor",k="audioWorklet",A=C+" "+k,W="RecProc",L="MediaRecorder",q=L+".WebM.PCM",m=n.createScriptProcessor||n.createJavaScriptNode,b=f("ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。",0,k),p=function(){S=e.isWorklet=!1,Me(e),G(f("7TU0::Connect采用老的{1}，",0,g)+ee.get(s[ve]?f("JwCL::但已设置{1}尝试启用{2}",2):f("VGjB::可设置{1}尝试启用{2}",2),[C+"."+ve+"=true",k])+P+b,3);var E=e._p=m.call(n,r,1,1);K(E),E.onaudioprocess=function(D){var N=D.inputBuffer.getChannelData(0);_(N,a)}},H=function(){y=e.isWebM=!1,Ae(e),S=e.isWorklet=!m||s[ve];var E=window.AudioWorkletNode;if(!(S&&n[k]&&E)){p();return}var D=function(){var Q=function(X){return X.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,A)},J="class "+W+" extends AudioWorkletProcessor{";return J+="constructor "+Q(function(X){DEL_super(X);var te=this,B=X.processorOptions.bufferSize;te.bufferSize=B,te.buffer=new Float32Array(B*2),te.pos=0,te.port.onmessage=function(Y){Y.data.kill&&(te.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",X)}),J+="process "+Q(function(X,te,B){var Y=this,ge=Y.bufferSize,ce=Y.buffer,fe=Y.pos;if(X=(X[0]||[])[0]||[],X.length){ce.set(X,fe),fe+=X.length;var he=~~(fe/ge)*ge;if(he){this.port.postMessage({val:ce.slice(0,he)});var Se=ce.subarray(he,fe);ce=new Float32Array(ge*2),ce.set(Se),fe=Se.length,Y.buffer=ce}Y.pos=fe}return!Y.kill}),J+='}try{registerProcessor("'+W+'", '+W+')}catch(e){$C.error("'+A+' Reg Error",e)}',J=J.replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(J)))},N=function(){return S&&e._na},V=e._na=function(){d!==""&&(clearTimeout(d),d=setTimeout(function(){d=0,N()&&(G(f("MxX1::{1}未返回任何音频，恢复使用{2}",0,k,g),3),m&&p())},500))},F=function(){if(N()){var Q=e._n=new E(n,W,{processorOptions:{bufferSize:r}});K(Q),Q.port.onmessage=function(J){d&&(clearTimeout(d),d=""),N()?_(J.data.val,a):S||G(f("XUap::{1}多余回调",0,k),3)},G(f("yOta::Connect采用{1}，设置{2}可恢复老式{3}",0,k,C+"."+ve+"=false",g)+P+b,3)}},U=function(){if(N()){if(n[W]){F();return}var Q=D();n[k].addModule(Q).then(function(J){N()&&(n[W]=1,F(),d&&V())})[ue](function(J){G(k+".addModule Error",1,J),N()&&p()})}};le(n,function(){return N()},U,U)},$=function(){var E=window[L],D="ondataavailable",N="audio/webm; codecs=pcm";y=e.isWebM=s[Ce];var V=E&&D in E.prototype&&E.isTypeSupported(N);if(P=V?"":f("VwPd::（此浏览器不支持{1}）",0,q),!y||!V){H();return}var F=function(){return y&&e._ra};e._ra=function(){d!==""&&(clearTimeout(d),d=setTimeout(function(){F()&&(G(f("vHnb::{1}未返回任何音频，降级使用{2}",0,L,k),3),H())},500))};var U=Object.assign({mimeType:N},s.ConnectWebMOptions),Q=e._r=new E(e,U),J=e._rd={};Q[D]=function(X){var te=new FileReader;te.onloadend=function(){if(F()){var B=Ke(new Uint8Array(te.result),J);if(!B)return;if(B==-1){H();return}d&&(clearTimeout(d),d=""),_(B,J.webmSR)}else y||G(f("O9P7::{1}多余回调",0,L),3)},te.readAsArrayBuffer(X.data)};try{Q.start(~~(r/48)),G(f("LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}",0,q,C+"."+Ce+"=false",k,g))}catch(X){G("mr start err",1,X),H()}};$()},Te=function(t){t._na&&t._na(),t._ra&&t._ra()},Me=function(t){t._na=null,t._n&&(t._n.port.postMessage({kill:!0}),t._n.disconnect(),t._n=null)},Ae=function(t){if(t._ra=null,t._r){try{t._r.stop()}catch(r){G("mr stop err",1,r)}t._r=null}},_e=function(t){t=t||s;var r=t==s,e=t.Stream;e&&(e._m&&(e._m.disconnect(),e._m=null),!e._RC&&e._c&&s.CloseNewCtx(e._c),e._RC=null,e._c=null,e._d&&(Ee(e._d.stream),e._d=null),e._p&&(e._p.disconnect(),e._p.onaudioprocess=e._p=null),Me(e),Ae(e),r&&Ee(e)),t.Stream=0},Ee=s.StopS_=function(t){for(var r=ke(t),e=0;e<r.length;e++){var n=r[e];n.stop&&n.stop()}t.stop&&t.stop()},ke=function(t){var r=0,e=0,n=[];t.getAudioTracks&&(r=t.getAudioTracks(),e=t.getVideoTracks()),r||(r=t.audioTracks,e=t.videoTracks);for(var a=0,o=r?r.length:0;a<o;a++)n.push(r[a]);for(var a=0,o=e?e.length:0;a<o;a++)n.push(e[a]);return n};s.SampleData=function(t,r,e,n,a){var o="SampleData";n||(n={});var i=n.index||0,w=n.offset||0,l=n.raisePrev||0,h=n.filter;if(h&&h.fn&&(h.sr&&h.sr!=r||h.srn&&h.srn!=e)&&(h=null,G(f("d48C::{1}的filter采样率变了，重设滤波",0,o),3)),!h)if(e<=r){var M=e>r*3/4?0:e/2*3/4;h={fn:M?s.IIRFilter(!0,r,M):0}}else{var M=r>e*3/4?0:r/2*3/4;h={fn:M?s.IIRFilter(!0,e,M):0}}h.sr=r,h.srn=e;var K=h.fn,y=n.frameNext||[];a||(a={});var S=a.frameSize||1;a.frameType&&(S=a.frameType=="mp3"?1152:1);var d=a._sum,P=0,z=t.length;i>z+1&&G(f("tlbC::{1}似乎传入了未重置chunk {2}",0,o,i+">"+z),3);for(var _=0,g=i;g<z;g++)_+=t[g].length;var k=r/e;if(k>1)_=Math.max(0,_-Math.floor(w)),_=Math.floor(_/k);else if(k<1){var A=1/k;_=Math.floor(_*A)}_+=y.length;for(var W=new Int16Array(_),L=0,g=0;g<y.length;g++)W[L]=y[g],L++;for(;i<z;i++){var q=t[i],m=q instanceof Float32Array,g=w,b=q.length,p=K&&K.Embed,H=0,$=0,E=0,D=0;if(k<1){for(var N=L+g,V=l,F=0;F<b;F++){var U=q[F];m&&(U=Math.max(-1,Math.min(1,U)),U=U<0?U*32768:U*32767);var Q=Math.floor(N);N+=A;for(var J=Math.floor(N),X=(U-V)/(J-Q),te=1;Q<J;Q++,te++){var B=Math.floor(V+te*X);p?(E=B,D=p.b0*E+p.b1*p.x1+p.b0*p.x2-p.a1*p.y1-p.a2*p.y2,p.x2=p.x1,p.x1=E,p.y2=p.y1,p.y1=D,B=D):B=K?K(B):B,B>32767?B=32767:B<-32768&&(B=-32768),d&&(P+=Math.abs(B)),W[Q]=B,L++}V=l=U,g+=A}w=g%1;continue}for(var F=0,Y=0;F<b;F++,Y++){if(Y<b){var U=q[Y];m&&(U=Math.max(-1,Math.min(1,U)),U=U<0?U*32768:U*32767),p?(E=U,D=p.b0*E+p.b1*p.x1+p.b0*p.x2-p.a1*p.y1-p.a2*p.y2,p.x2=p.x1,p.x1=E,p.y2=p.y1,p.y1=D):D=K?K(U):U}if(H=$,$=D,Y==0){F--;continue}var ge=Math.floor(g);if(F==ge){var ce=Math.ceil(g),fe=g-ge,he=H,Se=ce<b?$:he,me=he+(Se-he)*fe;me>32767?me=32767:me<-32768&&(me=-32768),d&&(P+=Math.abs(me)),W[L]=me,L++,g+=k}}w=Math.max(0,g-b)}k<1&&L+1==_&&(_--,W=new Int16Array(W.buffer.slice(0,_*2))),L-1!=_&&L!=_&&G(o+" idx:"+L+" != size:"+_,3),y=null;var Pe=_%S;if(Pe>0){var Re=(_-Pe)*2;y=new Int16Array(W.buffer.slice(Re)),W=new Int16Array(W.buffer.slice(0,Re))}var Oe={index:i,offset:w,raisePrev:l,filter:h,frameNext:y,sampleRate:e,data:W};return d&&(Oe._sum=P),Oe},s.IIRFilter=function(t,r,e){var n=2*Math.PI*e/r,a=Math.sin(n),o=Math.cos(n),i=a/2,w=1+i,l=-2*o/w,h=(1-i)/w;if(t)var M=(1-o)/2/w,K=(1-o)/w;else var M=(1+o)/2/w,K=-(1+o)/w;var y=0,S=0,d=0,P=0,z=0,_=function(g){return d=M*g+K*y+M*S-l*P-h*z,S=y,y=g,z=P,P=d,d};return _.Embed={x1:0,x2:0,y1:0,y2:0,b0:M,b1:K,a1:l,a2:h},_},s.PowerLevel=function(t,r){var e=t/r||0,n;return e<1251?n=Math.round(e/1250*10):n=Math.round(Math.min(100,Math.max(0,(1+Math.log(e/1e4)/Math.log(10))*100))),n},s.PowerDBFS=function(t){var r=Math.max(.1,t||0),e=32767;return r=Math.min(r,e),r=20*Math.log(r/e)/Math.log(10),Math.max(-100,Math.round(r))},s.CLog=function(t,r){if(typeof console=="object"){var e=new Date,n=("0"+e.getMinutes()).substr(-2)+":"+("0"+e.getSeconds()).substr(-2)+"."+("00"+e.getMilliseconds()).substr(-3),a=this&&this.envIn&&this.envCheck&&this.id,o=["["+n+" "+C+(a?":"+a:"")+"]"+t],i=arguments,w=s.CLog,l=2,h=w.log||console.log;for(I(r)?h=r==1?w.error||console.error:r==3?w.warn||console.warn:h:l=1;l<i.length;l++)o.push(i[l]);Le?h&&h("[IsLoser]"+o[0],o.length>1?o:""):h.apply(console,o)}};var G=function(){s.CLog.apply(this,arguments)},Le=!0;try{Le=!console.log.apply}catch{}var Be=0;function Ie(t){var r=this;r.id=++Be,De();var e={type:"mp3",onProcess:x};for(var n in t)e[n]=t[n];r.set=e;var a=e[pe],o=e[j];(a&&!I(a)||o&&!I(o))&&r.CLog(f.G("IllegalArgs-1",[f("VtS4::{1}和{2}必须是数值",0,j,pe)]),1,t),e[pe]=+a||16,e[j]=+o||16e3,r.state=0,r._S=9,r.Sync={O:9,C:9}}s.Sync={O:9,C:9},s.prototype=Ie.prototype={CLog:G,_streamStore:function(){return this.set.sourceStream?this:s},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var t=this._streamGet();return t&&t._c},open:function(t,r){var e=this,n=e.set,a=e._streamStore(),o=0;t=t||x;var i=function(m,b){b=!!b,e.CLog(f("5tWi::录音open失败：")+m+",isUserNotAllow:"+b,1),o&&s.CloseNewCtx(o),r&&r(m,b)};e._streamTag=O;var w=function(){e.CLog("open ok, id:"+e.id+" stream:"+e._streamTag),t(),e._SO=0},l=a.Sync,h=++l.O,M=l.C;e._O=e._O_=h,e._SO=e._S;var K=function(){if(M!=l.C||!e._O){var m=f("dFm8::open被取消");return h==l.O?e.close():m=f("VtJO::open被中断"),i(m),!0}};if(!c){i(f.G("NonBrowser-1",["open"])+f("EMJq::，可尝试使用RecordApp解决方案")+"("+T+"/tree/master/app-support-sample)");return}var y=e.envCheck({envName:"H5",canProcess:!0});if(y){i(f("A5bm::不能录音：")+y);return}var S,d=function(){S=n.runningContext,S||(S=o=s.GetContext(!0))};if(n.sourceStream){if(e._streamTag="set.sourceStream",!s.GetContext()){i(f("1iU7::不支持此浏览器从流中获取录音"));return}d(),_e(a);var P=e.Stream=n.sourceStream;P._c=S,P._RC=n.runningContext,P._call={};try{xe(a)}catch(m){_e(a),i(f("BTW2::从流中打开录音失败：")+m.message);return}w();return}var z=function(m,b){try{window.top.a}catch{i(f("Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})",0,'allow="camera;microphone"'));return}_(1,m)&&(/Found/i.test(m)?i(b+f("jBa9::，无可用麦克风")):i(b))},_=function(m,b){if(/Permission|Allow/i.test(b))m&&i(f("gyO5::用户拒绝了录音权限"),!0);else if(window.isSecureContext===!1)m&&i(f("oWNo::浏览器禁止不安全页面录音，可开启https解决"));else return 1};if(s.IsOpen()){w();return}if(!s.Support()){z("",f("COxc::此浏览器不支持录音"));return}d();var g=function(m){setTimeout(function(){m._call={};var b=s.Stream;b&&(_e(),m._call=b._call),s.Stream=m,m._c=S,m._RC=n.runningContext,!K()&&(s.IsOpen()?(b&&e.CLog(f("upb8::发现同时多次调用open"),1),xe(a),w()):i(f("Q1GA::录音功能无效：无音频流")))},100)},k=function(m){var b=m.name||m.message||m.code+":"+m,p="";A==1&&_(0,b)&&(p=f("KxE2::，将尝试禁用回声消除后重试"));var H=f("xEQR::请求录音权限错误"),$=f("bDOG::无法录音：");e.CLog(H+p+"|"+m,p||L?3:1,m),p?(W=b,L=m,q(1)):L?(e.CLog(H+"|"+L,1,L),z(W,$+L)):z(b,$+m)},A=0,W,L,q=function(m){A++;var b="audioTrackSet",p="autoGainControl",H="echoCancellation",$="noiseSuppression",E=b+":{"+H+","+$+","+p+"}",D=JSON.parse(R(n[b]||!0));e.CLog("open... "+A+" "+b+":"+R(D)),m&&(typeof D!="object"&&(D={}),D[p]=!1,D[H]=!1,D[$]=!1),D[j]&&e.CLog(f("IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象",0,b+"."+j),3);var N={audio:D,video:n.videoTrackSet||!1};try{var V=s.Scope[O](N,g,k)}catch(F){e.CLog(O,3,F),N={audio:!0,video:!1},V=s.Scope[O](N,g,k)}e.CLog(O+"("+R(N)+") "+ye(S)+f("RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置",0,E,b)+"("+T+") LM:"+u+" UA:"+navigator.userAgent),V&&V.then&&V.then(g)[ue](k)};q()},close:function(t){t=t||x;var r=this,e=r._streamStore();r._stop();var n=" stream:"+r._streamTag,a=e.Sync;if(r._O=0,r._O_!=a.O){r.CLog(f("hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）")+n,3),t();return}a.C++,_e(e),r.CLog("close,"+n),t()},mock:function(t,r){var e=this;return e._stop(),e.isMock=1,e.mockEnvInfo=null,e.buffers=[t],e.recSize=t.length,e._setSrcSR(r),e._streamTag="mock",e},_setSrcSR:function(t){var r=this,e=r.set,n=e[j];n>t?e[j]=t:n=0,r[re]=t,r.CLog(re+": "+t+" set."+j+": "+e[j]+(n?" "+f("UHvm::忽略")+": "+n:""),n?3:0)},envCheck:function(t){var r,e=this,n=e.set,a="CPU_BE";if(!r&&!s[a]&&typeof Int8Array=="function"&&!new Int8Array(new Int32Array([1]).buffer)[0]&&(De(a),r=f("Essp::不支持{1}架构",0,a)),!r){var o=n.type,i=e[o+"_envCheck"];n.takeoffEncodeChunk&&(i?t.canProcess||(r=f("7uMV::{1}环境不支持实时处理",0,t.envName)):r=f("2XBl::{1}类型不支持设置takeoffEncodeChunk",0,o)+(e[o]?"":f("LG7e::(未加载编码器)"))),!r&&i&&(r=e[o+"_envCheck"](t,n))}return r||""},envStart:function(t,r){var e=this,n=e.set;if(e.isMock=t?1:0,e.mockEnvInfo=t,e.buffers=[],e.recSize=0,t&&(e._streamTag="env$"+t.envName),e.state=1,e.envInLast=0,e.envInFirst=0,e.envInFix=0,e.envInFixTs=[],e._setSrcSR(r),e.engineCtx=0,e[n.type+"_start"]){var a=e.engineCtx=e[n.type+"_start"](n);a&&(a.pcmDatas=[],a.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(t,r){var e=this,n=e.set,a=e.engineCtx;if(e.state!=1){e.state||e.CLog("envIn at state=0",3);return}var o=e[re],i=t.length,w=s.PowerLevel(r,i),l=e.buffers,h=l.length;l.push(t);var M=l,K=h,y=Date.now(),S=Math.round(i/o*1e3);e.envInLast=y,e.buffers.length==1&&(e.envInFirst=y-S);var d=e.envInFixTs;d.splice(0,0,{t:y,d:S});for(var P=y,z=0,_=0;_<d.length;_++){var g=d[_];if(y-g.t>3e3){d.length=_;break}P=g.t,z+=g.d}var k=d[1],A=y-P,W=A-z;if(W>A/3&&(k&&A>1e3||d.length>=6)){var L=y-k.t-S;if(L>S/5){var q=!n.disableEnvInFix;if(e.CLog("["+y+"]"+ee.get(f(q?"4Kfd::补偿{1}ms":"bM5i::未补偿{1}ms",1),[L]),3),e.envInFix+=L,q){var m=new Int16Array(L*o/1e3);i+=m.length,l.push(m)}}}var b=e.recSize,p=i,H=b+p;if(e.recSize=H,a){var $=s.SampleData(l,o,n[j],a.chunkInfo);a.chunkInfo=$,b=a.pcmSize,p=$.data.length,H=b+p,a.pcmSize=H,l=a.pcmDatas,h=l.length,l.push($.data),o=$[j]}var E=Math.round(H/o*1e3),D=l.length,N=M.length,V=function(){for(var X=F?0:-p,te=l[0]==null,B=h;B<D;B++){var Y=l[B];Y==null?te=1:(X+=Y.length,a&&Y.length&&e[n.type+"_encode"](a,Y))}if(te&&a){var B=K;for(M[0]&&(B=0);B<N;B++)M[B]=null}te&&(X=F?p:0,l[0]=null),a?a.pcmSize+=X:e.recSize+=X},F=0,U="rec.set.onProcess";try{F=n.onProcess(l,w,E,o,h,V),F=F===!0}catch(X){console.error(U+f("gFUF::回调出错是不允许的，需保证不会抛异常"),X)}var Q=Date.now()-y;if(Q>10&&e.envInFirst-y>1e3&&e.CLog(U+f("2ghS::低性能，耗时{1}ms",0,Q),3),F){for(var J=0,_=h;_<D;_++)l[_]==null?J=1:l[_]=new Int16Array(0);J?e.CLog(f("ufqH::未进入异步前不能清除buffers"),3):a?a.pcmSize-=p:e.recSize-=p}else V()},start:function(){var t=this,r=1;if(t.set.sourceStream?t.Stream||(r=0):s.IsOpen()||(r=0),!r){t.CLog(f("6WmN::start失败：未open"),1);return}var e=t._streamCtx();if(t.CLog(f("kLDN::start 开始录音，")+ye(e)+" stream:"+t._streamTag),t._stop(),t.envStart(null,e[j]),t.state=3,t._SO&&t._SO+1!=t._S){t.CLog(f("Bp2y::start被中断"),3);return}t._SO=0;var n=function(){t.state==3&&(t.state=1,t.resume())},a="AudioContext resume: ",o=t._streamGet();o._call[t.id]=function(){t.CLog(a+e.state+"|stream ok"),n()},le(e,function(i){return i&&t.CLog(a+"wait..."),t.state==3},function(i){i&&t.CLog(a+e.state),n()},function(i){t.CLog(a+e.state+f("upkE::，可能无法录音：")+i,1),n()})},pause:function(){var t=this,r=t._streamGet();t.state&&(t.state=2,t.CLog("pause"),r&&delete r._call[t.id])},resume:function(){var t=this,r=t._streamGet(),e="resume",n=e+"(wait ctx)";if(t.state==3)t.CLog(n);else if(t.state){t.state=1,t.CLog(e),t.envResume(),r&&(r._call[t.id]=function(o,i){t.state==1&&t.envIn(o,i)},Te(r));var a=t._streamCtx();a&&le(a,function(o){return o&&t.CLog(n+"..."),t.state==1},function(o){o&&t.CLog(n+a.state),Te(r)},function(o){t.CLog(n+a.state+"[err]"+o,1)})}},_stop:function(t){var r=this,e=r.set;r.isMock||r._S++,r.state&&(r.pause(),r.state=0),!t&&r[e.type+"_stop"]&&(r[e.type+"_stop"](r.engineCtx),r.engineCtx=0)},stop:function(t,r,e){var n=this,a=n.set,o,i=n.envInLast-n.envInFirst,w=i&&n.buffers.length;n.CLog(f("Xq4s::stop 和start时差:")+(i?i+"ms "+f("3CQP::补偿:")+n.envInFix+"ms envIn:"+w+" fps:"+(w/i*1e3).toFixed(1):"-")+" stream:"+n._streamTag+" ("+T+") LM:"+u);var l=function(){n._stop(),e&&n.close()},h=function(g){n.CLog(f("u8JG::结束录音失败：")+g,1),r&&r(g),l()},M=function(g,k,A){var W="blob",L="arraybuffer",q="dataType",m="DefaultDataType",b=n[q]||s[m]||W,p=q+"="+b,H=g instanceof ArrayBuffer,$=0,E=H?g.byteLength:g.size;if(b==L?H||($=1):b==W?typeof Blob!="function"?$=f.G("NonBrowser-1",[p])+f("1skY::，请设置{1}",0,C+"."+m+'="'+L+'"'):(H&&(g=new Blob([g],{type:k})),g instanceof Blob||($=1),k=g.type||k):$=f.G("NotSupport-1",[p]),n.CLog(f("Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b",0,Date.now()-o,A,E)+" "+p+","+k),$){h($!=1?$:f("Vkbd::{1}编码器返回的不是{2}",0,a.type,b)+", "+p);return}if(a.takeoffEncodeChunk)n.CLog(f("QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据"),3);else if(E<Math.max(50,A/5)){h(f("Sz2H::生成的{1}无效",0,a.type));return}t&&t(g,A,k),l()};if(!n.isMock){var K=n.state==3;if(!n.state||K){h(f("wf9t::未开始录音")+(K?f("Dl2c::，开始录音前无用户交互导致AudioContext未运行"):""));return}}n._stop(!0);var y=n.recSize;if(!y){h(f("Ltz3::未采集到录音"));return}if(!n[a.type]){h(f("xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载",0,a.type,C));return}if(n.isMock){var S=n.envCheck(n.mockEnvInfo||{envName:"mock",canProcess:!1});if(S){h(f("AxOH::录音错误：")+S);return}}var d=n.engineCtx;if(n[a.type+"_complete"]&&d){var _=Math.round(d.pcmSize/a[j]*1e3);o=Date.now(),n[a.type+"_complete"](d,function(k,A){M(k,A,_)},h);return}if(o=Date.now(),!n.buffers[0]){h(f("xkKd::音频buffers被释放"));return}var P=s.SampleData(n.buffers,n[re],a[j]);a[j]=P[j];var z=P.data,_=Math.round(z.length/a[j]*1e3);n.CLog(f("CxeT::采样:{1} 花:{2}ms",0,y+"->"+z.length,Date.now()-o)),setTimeout(function(){o=Date.now(),n[a.type](z,function(g,k){M(g,k,_)},function(g){h(g)})})}};var Ke=function(t,r){r.pos||(r.pos=[0],r.tracks={},r.bytes=[]);var e=r.tracks,n=[r.pos[0]],a=function(){r.pos[0]=n[0]},o=r.bytes.length,i=new Uint8Array(o+t.length);if(i.set(r.bytes),i.set(t,o),r.bytes=i,!r._ht){if(oe(i,n),de(i,n),!ne(oe(i,n),[24,83,128,103]))return;for(oe(i,n);n[0]<i.length;){var w=oe(i,n),l=de(i,n),h=[0],M=0;if(!l)return;if(ne(w,[22,84,174,107])){for(;h[0]<l.length;){var K=oe(l,h),y=de(l,h),S=[0],d={channels:0,sampleRate:0};if(ne(K,[174]))for(;S[0]<y.length;){var P=oe(y,S),z=de(y,S),_=[0];if(ne(P,[215])){var g=be(z);d.number=g,e[g]=d}else if(ne(P,[131])){var g=be(z);g==1?d.type="video":g==2?(d.type="audio",M||(r.track0=d),d.idx=M++):d.type="Type-"+g}else if(ne(P,[134])){for(var k="",A=0;A<z.length;A++)k+=String.fromCharCode(z[A]);d.codec=k}else if(ne(P,[225]))for(;_[0]<z.length;){var W=oe(z,_),L=de(z,_);if(ne(W,[181])){var g=0,q=new Uint8Array(L.reverse()).buffer;L.length==4?g=new Float32Array(q)[0]:L.length==8?g=new Float64Array(q)[0]:G("WebM Track !Float",1,L),d[j]=Math.round(g)}else ne(W,[98,100])?d.bitDepth=be(L):ne(W,[159])&&(d.channels=be(L))}}}r._ht=1,G("WebM Tracks",e),a();break}}}var m=r.track0;if(m){var b=m[j];if(r.webmSR=b,m.bitDepth==16&&/FLOAT/i.test(m.codec)&&(m.bitDepth=32,G("WebM 16->32 bit",3)),b<8e3||m.bitDepth!=32||m.channels<1||!/(\b|_)PCM\b/i.test(m.codec))return r.bytes=[],r.bad||G("WebM Track Unexpected",3,r),r.bad=1,-1;for(var p=[],H=0;n[0]<i.length;){var K=oe(i,n),y=de(i,n);if(!y)break;if(ne(K,[163])){var $=y[0]&15,d=e[$];if(d){if(d.idx===0){for(var E=new Uint8Array(y.length-4),A=4;A<y.length;A++)E[A-4]=y[A];p.push(E),H+=E.length}}else return G("WebM !Track"+$,1,e),-1}a()}if(H){var D=new Uint8Array(i.length-r.pos[0]);D.set(i.subarray(r.pos[0])),r.bytes=D,r.pos[0]=0;for(var E=new Uint8Array(H),A=0,N=0;A<p.length;A++)E.set(p[A],N),N+=p[A].length;var q=new Float32Array(E.buffer);if(m.channels>1){for(var V=[],A=0;A<q.length;)V.push(q[A]),A+=m.channels;q=new Float32Array(V)}return q}}},ne=function(t,r){if(!t||t.length!=r.length)return!1;if(t.length==1)return t[0]==r[0];for(var e=0;e<t.length;e++)if(t[e]!=r[e])return!1;return!0},be=function(t){for(var r="",e=0;e<t.length;e++){var n=t[e];r+=(n<16?"0":"")+n.toString(16)}return parseInt(r,16)||0},oe=function(t,r,e){var n=r[0];if(!(n>=t.length)){var a=t[n],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var w=i[1].length,l=[];if(!(n+w>t.length)){for(var h=0;h<w;h++)l[h]=t[n],n++;return e&&(l[0]=parseInt(i[2]||"0",2)),r[0]=n,l}}}},de=function(t,r){var e=oe(t,r,1);if(e){var n=be(e),a=r[0],o=[];if(n<2147483647){if(a+n>t.length)return;for(var i=0;i<n;i++)o[i]=t[a],a++}return r[0]=a,o}},ee=s.i18n={lang:"zh-CN",alias:{"zh-CN":"zh","en-US":"en"},locales:{},data:{},put:function(t,r){var e=C+".i18n.put: ",n=t.overwrite;n=n==null||n;var a=t.lang;if(a=ee.alias[a]||a,!a)throw new Error(e+"set.lang?");var o=ee.locales[a];o||(o={},ee.locales[a]=o);for(var i=/^([\w\-]+):/,w,l=0;l<r.length;l++){var M=r[l];if(w=i.exec(M),!w){G(e+"'key:'? "+M,3,t);continue}var h=w[1],M=M.substr(h.length+1);!n&&o[h]||(o[h]=M)}},get:function(){return ee.v_G.apply(null,arguments)},v_G:function(t,r,e){r=r||[],e=e||ee.lang,e=ee.alias[e]||e;var n=ee.locales[e],a=n&&n[t]||"";return!a&&e!="zh"?e=="en"?ee.v_G(t,r,"zh"):ee.v_G(t,r,"en"):(ee.lastLang=e,a=="=Empty"?"":a.replace(/\{(\d+)(\!?)\}/g,function(o,i,w){return i=+i||0,o=r[i-1],(i<1||i>r.length)&&(o="{?}",G("i18n["+t+"] no {"+i+"}: "+a,3)),w?"":o}))},$T:function(){return ee.v_T.apply(null,arguments)},v_T:function(){for(var t=arguments,r="",e=[],n=0,a=C+".i18n.$T:",o=/^([\w\-]*):/,i,w=0;w<t.length;w++){var l=t[w];if(w==0){if(i=o.exec(l),r=i&&i[1],!r)throw new Error(a+"0 'key:'?");l=l.substr(r.length+1)}if(n===-1)e.push(l);else{if(n)throw new Error(a+" bad args");if(l===0)n=-1;else if(I(l)){if(l<1)throw new Error(a+" bad args");n=l}else{var h=w==1?"en":w?"":"zh";if(i=o.exec(l),i&&(h=i[1]||h,l=l.substr(i[1].length+1)),!i||!h)throw new Error(a+w+" 'lang:'?");ee.put({lang:h,overwrite:!1},[r+":"+l])}}}return r?n>0?r:ee.v_G(r,e):""}},f=ee.$T;f.G=ee.get,f("NonBrowser-1::非浏览器环境，不支持{1}",1),f("IllegalArgs-1::参数错误：{1}",1),f("NeedImport-2::调用{1}需要先导入{2}",2),f("NotSupport-1::不支持：{1}",1),s.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var De=s.Traffic=function(t){if(c){t=t?"/"+C+"/Report/"+t:"";var r=s.TrafficImgUrl;if(r){var e=s.Traffic,n=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],a=n[1]||"http://file/",o=(n[0]||a)+t;if(r.indexOf("//")==0&&(/^https:/i.test(o)?r="https:"+r:r="http:"+r),t&&(r=r+"&cu="+encodeURIComponent(a+t)),!e[o]){e[o]=1;var i=new Image;i.src=r,G("Traffic Analysis Image: "+(t||C+".TrafficImgUrl="+s.TrafficImgUrl))}}}};ae&&(G(f("8HO5::覆盖导入{1}",0,C),1),ae.Destroy()),v[C]=s})})(Ge);var Fe=Ge.exports;const Je=$e(Fe);(function(Z){var v=typeof window=="object"&&!!window.document,c=v?window:Object,x=c.Recorder,I=x.i18n;Z(x,I,I.$T,v)})(function(Z,v,c,x){Z.prototype.enc_pcm={stable:!0,fast:!0,getTestMsg:function(){return c("fWsN::pcm为未封装的原始音频数据，pcm音频文件无法直接播放，可用Recorder.pcm2wav()转码成wav播放；支持位数8位、16位（填在比特率里面），采样率取值无限制")}};var I=function(u){var T=u.bitRate,C=T==8?8:16;T!=C&&Z.CLog(c("uMUJ::PCM Info: 不支持{1}位，已更新成{2}位",0,T,C),3),u.bitRate=C};Z.prototype.pcm=function(u,T,C){var O=this.set;I(O);var re=R(u,O.bitRate);T(re.buffer,"audio/pcm")};var R=function(u,T){if(T==8)for(var C=u.length,O=new Uint8Array(C),re=0;re<C;re++){var j=(u[re]>>8)+128;O[re]=j}else{u=new Int16Array(u);var O=new Uint8Array(u.buffer)}return O};Z.pcm2wav=function(u,T,C){u.blob||(u={blob:u});var O=u.blob,re=u.sampleRate||16e3,j=u.bitRate||16;if((!u.sampleRate||!u.bitRate)&&Z.CLog(c("KmRz::pcm2wav必须提供sampleRate和bitRate"),3),!Z.prototype.wav){C(c.G("NeedImport-2",["pcm2wav","src/engine/wav.js"]));return}var pe=function(ae,we){var ie;if(j==8){var le=new Uint8Array(ae);ie=new Int16Array(le.length);for(var se=0;se<le.length;se++)ie[se]=le[se]-128<<8}else ie=new Int16Array(ae);var ye=Z({type:"wav",sampleRate:re,bitRate:j});we&&(ye.dataType="arraybuffer"),ye.mock(ie,re).stop(function(Ce,ve,xe){T(Ce,ve,xe)},C)};if(O instanceof ArrayBuffer)pe(O,1);else{var ue=new FileReader;ue.onloadend=function(){pe(ue.result)},ue.readAsArrayBuffer(O)}},Z.prototype.pcm_envCheck=function(u,T){return""},Z.prototype.pcm_start=function(u){return I(u),{set:u,memory:new Uint8Array(5e5),mOffset:0}};var s=function(u,T){var C=T.length;if(u.mOffset+C>u.memory.length){var O=new Uint8Array(u.memory.length+Math.max(5e5,C));O.set(u.memory.subarray(0,u.mOffset)),u.memory=O}u.memory.set(T,u.mOffset),u.mOffset+=C};Z.prototype.pcm_stop=function(u){u&&u.memory&&(u.memory=null)},Z.prototype.pcm_encode=function(u,T){if(u&&u.memory){var C=u.set,O=R(T,C.bitRate);C.takeoffEncodeChunk?C.takeoffEncodeChunk(O):s(u,O)}},Z.prototype.pcm_complete=function(u,T,C,O){if(u&&u.memory){O&&this.pcm_stop(u);var re=u.memory.buffer.slice(0,u.mOffset);T(re,"audio/pcm")}else C(c("sDkA::pcm编码器未start"))}});const ze=Je;class Ne{constructor(v,c){this.apiKey=v,this.secretKey=c}static createWithGetters(v,c){const x=new Ne("","");return x.apiKeyGetter=v,x.secretKeyGetter=c,x}getCurrentApiKey(){return this.apiKeyGetter?this.apiKeyGetter():this.apiKey}getCurrentSecretKey(){return this.secretKeyGetter?this.secretKeyGetter():this.secretKey}async start(v){this.callbacks=v;try{this.accessToken||await this.getAccessToken(),this.recorder=ze({type:"pcm",sampleRate:16e3,bitRate:16}),this.recorder.open(()=>{var c;(c=this.recorder)==null||c.start(),v.onStart()},(c,x)=>{const I=x?`用户拒绝了麦克风权限: ${c}`:`无法打开麦克风: ${c}`;v.onError(new Error(I))})}catch(c){v.onError(c instanceof Error?c:new Error("百度语音服务启动失败"))}}async stop(){this.recorder&&this.recorder.stop((v,c)=>{console.log(`录音成功，格式: ${v.type}，时长: ${c}ms`,v),this.processWithBaiduAPI(v),this.closeRecorder()},v=>{var c;(c=this.callbacks)==null||c.onError(new Error(`录音失败: ${v}`)),this.closeRecorder()})}isSupported(){return!0}closeRecorder(){this.recorder&&(this.recorder.close(),this.recorder=void 0)}async getAccessToken(){const v=this.getCurrentApiKey(),c=this.getCurrentSecretKey(),I=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api/baidu/oauth/2.0/token":"https://aip.baidubce.com/oauth/2.0/token",R=new URLSearchParams;R.append("grant_type","client_credentials"),R.append("client_id",v),R.append("client_secret",c);const u=await(await fetch(I,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:R.toString()})).json();if(u.access_token)this.accessToken=u.access_token;else throw new Error(u.error_description||"获取访问令牌失败")}async processWithBaiduAPI(v){var c;if(!(!this.callbacks||!this.accessToken))try{const x=await this.blobToBase64(v),R=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api/server/server_api":"https://vop.baidu.com/server_api",u=await(await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({format:"pcm",rate:16e3,channel:1,cuid:"V9yRZ6nNWlJPbqrxKBk1Xng2CmvzeupQ",token:this.accessToken,speech:x,len:v.size})})).json();if(u.err_no===0&&((c=u.result)==null?void 0:c.length)>0){const T=u.result[0];this.callbacks.onFinal(T),this.callbacks.onEnd(T)}else throw new Error(u.err_msg||`识别失败，错误码: ${u.err_no}`)}catch(x){this.callbacks.onError(x instanceof Error?x:new Error("百度语音识别失败"))}}blobToBase64(v){return new Promise((c,x)=>{const I=new FileReader;I.onload=()=>{const R=I.result.split(",")[1];c(R)},I.onerror=x,I.readAsDataURL(v)})}}class He{start(v){this.callbacks=v,v.onStart();let c=0;const x=["正在","正在识别","正在识别语音","正在识别语音内容"];this.timer=setInterval(()=>{if(c<x.length)v.onInterim(x[c]),c++;else{const I="这是一个模拟的语音识别结果";v.onFinal(I),v.onEnd(I),this.cleanup()}},500)}stop(){this.callbacks&&this.callbacks.onEnd(),this.cleanup()}isSupported(){return!0}cleanup(){this.timer&&(clearInterval(this.timer),this.timer=void 0)}}class Ue{constructor(v,c){this.appKey=v,this.token=c}static createWithGetters(v,c){const x=new Ue("","");return x.appKeyGetter=v,x.tokenGetter=c,x}getCurrentAppKey(){return this.appKeyGetter?this.appKeyGetter():this.appKey}getCurrentToken(){return this.tokenGetter?this.tokenGetter():this.token}async start(v){this.callbacks=v;try{this.recorder=ze({type:"pcm",sampleRate:16e3,bitRate:16}),this.recorder.open(()=>{var c;(c=this.recorder)==null||c.start(),v.onStart()},(c,x)=>{const I=x?`用户拒绝了麦克风权限: ${c}`:`无法打开麦克风: ${c}`;v.onError(new Error(I))})}catch(c){v.onError(c instanceof Error?c:new Error("阿里云语音服务启动失败"))}}async stop(){this.recorder&&this.recorder.stop((v,c)=>{console.log(`录音成功，格式: ${v.type}，时长: ${c}ms`,v),this.processWithAliyunAPI(v),this.closeRecorder()},v=>{var c;(c=this.callbacks)==null||c.onError(new Error(`录音失败: ${v}`)),this.closeRecorder()})}isSupported(){return!0}closeRecorder(){this.recorder&&(this.recorder.close(),this.recorder=void 0)}async processWithAliyunAPI(v){if(this.callbacks)try{const c=this.getCurrentAppKey(),x=this.getCurrentToken(),R=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api/aliyun/asr":"https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr",s=new URLSearchParams({appkey:c,format:"pcm",sample_rate:"16000",enable_punctuation_prediction:"true",enable_inverse_text_normalization:"true"}),u=await fetch(`${R}?${s.toString()}`,{method:"POST",headers:{"Content-Type":"application/octet-stream","X-NLS-Token":x},body:v});if(!u.ok){const C=await u.text();throw new Error(`HTTP 错误! 状态码: ${u.status}, 响应: ${C}`)}const T=await u.json();if(T.status===2e7&&T.result){const C=T.result;this.callbacks.onFinal(C),this.callbacks.onEnd(C)}else throw new Error(T.message||`识别失败，状态码: ${T.status}`)}catch(c){this.callbacks.onError(c instanceof Error?c:new Error("阿里云语音识别失败"))}}}class We{constructor(v,c){this.appKey=v,this.token=c}static createWithGetters(v,c){const x=new We("","");return x.appKeyGetter=v,x.tokenGetter=c,x}getCurrentAppKey(){return this.appKeyGetter?this.appKeyGetter():this.appKey}getCurrentToken(){return this.tokenGetter?this.tokenGetter():this.token}generateUUID(){return crypto.randomUUID().replace(/-/g,"")}isSupported(){return!0}async start(v){if(!this.isSupported()){v.onError(new Error("当前浏览器不支持实时语音识别所需的功能"));return}this.callbacks=v,this.setupWebSocket()}setupWebSocket(){const v=this.getCurrentToken(),x=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?`ws://${window.location.host}/api/aliyun/ws?token=${v}`:`wss://nls-gateway.cn-shanghai.aliyuncs.com/ws/v1?token=${v}`;this.ws=new WebSocket(x),this.ws.onopen=()=>{var R;const I={header:{appkey:this.getCurrentAppKey(),namespace:"SpeechTranscriber",name:"StartTranscription",task_id:this.generateUUID(),message_id:this.generateUUID()},payload:{format:"pcm",sample_rate:16e3,enable_intermediate_result:!0,enable_punctuation_prediction:!0,enable_inverse_text_normalization:!0}};(R=this.ws)==null||R.send(JSON.stringify(I))},this.ws.onmessage=I=>{var s,u,T,C,O;const R=JSON.parse(I.data);switch(R.header.name){case"TranscriptionStarted":(s=this.callbacks)==null||s.onStart(),this.startAudioProcessing();break;case"TranscriptionResultChanged":R.payload.result&&((u=this.callbacks)==null||u.onInterim(R.payload.result));break;case"SentenceEnd":R.payload.result&&((T=this.callbacks)==null||T.onFinal(R.payload.result));break;case"TranscriptionCompleted":(C=this.callbacks)==null||C.onEnd();break;case"TaskFailed":(O=this.callbacks)==null||O.onError(new Error(`任务失败: ${R.payload.status_text||"未知错误"}`)),this.cleanup();break}},this.ws.onerror=()=>{var I;(I=this.callbacks)==null||I.onError(new Error("WebSocket 连接发生错误")),this.cleanup()},this.ws.onclose=()=>{this.cleanup()}}async startAudioProcessing(){var v;try{this.audioStream=await navigator.mediaDevices.getUserMedia({audio:!0});const c=window.AudioContext||window.webkitAudioContext;if(!c)throw new Error("AudioContext not supported");this.audioContext=new c({sampleRate:16e3}),this.scriptProcessor=this.audioContext.createScriptProcessor(2048,1,1),this.scriptProcessor.onaudioprocess=I=>{var u;const R=I.inputBuffer.getChannelData(0),s=new Int16Array(R.length);for(let T=0;T<R.length;T++)s[T]=Math.max(-1,Math.min(1,R[T]))*32767;((u=this.ws)==null?void 0:u.readyState)===WebSocket.OPEN&&this.ws.send(s.buffer)},this.audioContext.createMediaStreamSource(this.audioStream).connect(this.scriptProcessor),this.scriptProcessor.connect(this.audioContext.destination)}catch(c){(v=this.callbacks)==null||v.onError(c instanceof Error?c:new Error("无法启动麦克风或音频处理")),this.cleanup()}}stop(){this.callbacks&&this.callbacks.onEnd(),this.cleanup()}cleanup(){this.audioStream&&(this.audioStream.getTracks().forEach(v=>v.stop()),this.audioStream=void 0),this.scriptProcessor&&(this.scriptProcessor.disconnect(),this.scriptProcessor=void 0),this.audioContext&&(this.audioContext.close(),this.audioContext=void 0),this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.ws=void 0}}export{We as A,Ne as B,He as M,Ue as a};
