import{d as I,p,h as B,c,o as h,j as e,e as y,af as g,al as b,a as k,am as w,t as f,G as V,k as P,F as M,B as U}from"./framework.CSeOnaMy.js";import{w as z}from"./theme.33nixD0a.js";class D{constructor(s,o){this.audioChunks=[],this.apiKey=s,this.secretKey=o}async start(s){this.callbacks=s;try{this.accessToken||await this.getAccessToken();const o=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1}});this.mediaRecorder=new MediaRecorder(o,{mimeType:"audio/webm;codecs=opus"}),this.audioChunks=[],this.mediaRecorder.ondataavailable=a=>{a.data.size>0&&this.audioChunks.push(a.data)},this.mediaRecorder.onstop=()=>{this.processWithBaiduAPI()},this.mediaRecorder.start(),s.onStart()}catch(o){s.onError(o instanceof Error?o:new Error("ç™¾åº¦è¯­éŸ³æœåŠ¡å¯åŠ¨å¤±è´¥"))}}async stop(){this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder.stream.getTracks().forEach(s=>s.stop()))}isSupported(){var s;return typeof navigator<"u"&&!!((s=navigator.mediaDevices)!=null&&s.getUserMedia)&&!!this.apiKey&&!!this.secretKey}async getAccessToken(){const o=await(await fetch("https://aip.baidubce.com/oauth/2.0/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=client_credentials&client_id=${this.apiKey}&client_secret=${this.secretKey}`})).json();if(o.access_token)this.accessToken=o.access_token;else throw new Error(o.error_description||"è·å–è®¿é—®ä»¤ç‰Œå¤±è´¥")}async processWithBaiduAPI(){var s;if(!(!this.callbacks||!this.accessToken))try{const o=new Blob(this.audioChunks,{type:"audio/wav"}),a=await this.blobToBase64(o),r=await(await fetch(`https://vop.baidu.com/server_api?access_token=${this.accessToken}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({format:"wav",rate:16e3,channel:1,cuid:"web_client",token:this.accessToken,speech:a,len:o.size})})).json();if(r.err_no===0&&((s=r.result)==null?void 0:s.length)>0){const l=r.result[0];this.callbacks.onFinal(l),this.callbacks.onEnd(l)}else throw new Error(r.err_msg||"è¯†åˆ«å¤±è´¥")}catch(o){this.callbacks.onError(o instanceof Error?o:new Error("ç™¾åº¦è¯­éŸ³è¯†åˆ«å¤±è´¥"))}}blobToBase64(s){return new Promise((o,a)=>{const n=new FileReader;n.onload=()=>{const r=n.result.split(",")[1];o(r)},n.onerror=a,n.readAsDataURL(s)})}}class F{start(s){this.callbacks=s,s.onStart();let o=0;const a=["æ­£åœ¨","æ­£åœ¨è¯†åˆ«","æ­£åœ¨è¯†åˆ«è¯­éŸ³","æ­£åœ¨è¯†åˆ«è¯­éŸ³å†…å®¹"];this.timer=setInterval(()=>{if(o<a.length)s.onInterim(a[o]),o++;else{const n="è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„è¯­éŸ³è¯†åˆ«ç»“æœ";s.onFinal(n),s.onEnd(n),this.cleanup()}},500)}stop(){this.callbacks&&this.callbacks.onEnd(),this.cleanup()}isSupported(){return!0}cleanup(){this.timer&&(clearInterval(this.timer),this.timer=void 0)}}const N={style:{display:"flex","flex-direction":"column",gap:"20px"}},j={style:{padding:"16px",background:"#f5f5f5","border-radius":"8px"}},H={style:{display:"grid","grid-template-columns":"1fr 1fr",gap:"12px","margin-bottom":"12px"}},L={style:{display:"flex",gap:"12px","align-items":"center"}},O={style:{display:"flex","align-items":"center",gap:"4px","font-size":"14px"}},$={style:{display:"flex","align-items":"center",gap:"4px","font-size":"14px"}},W={key:0,style:{padding:"12px",background:"#e8f4fd","border-radius":"6px","border-left":"4px solid #1890ff"}},G={style:{"font-weight":"500",color:"#1890ff"}},J={key:0,style:{"margin-top":"8px",color:"#666","font-style":"italic"}},q={key:1,style:{padding:"12px",background:"#fff2f0","border-radius":"6px","border-left":"4px solid #ff4d4f"}},Q={style:{"margin-top":"4px",color:"#666"}},X={key:2,style:{padding:"16px",background:"#f9f9f9","border-radius":"8px"}},Y={style:{"max-height":"200px","overflow-y":"auto"}},Z={style:{"font-size":"12px",color:"#999","margin-bottom":"4px"}},se=I({__name:"CustomSpeech",setup(x){const s=p(""),o=p(""),a=p(!1),n=p(!0),r=p(""),l=p(""),u=p(""),v=p(""),m=p([]),S=B(()=>({mode:"custom",customHandler:n.value?new F:new D(s.value,o.value),autoReplace:a.value,interimResults:!0})),T=()=>{l.value="ğŸ¤ æ­£åœ¨å½•éŸ³...",u.value="",v.value=""},_=d=>{u.value=d},E=d=>{l.value="âœ… è¯†åˆ«å®Œæˆ",u.value="",m.value.unshift({text:d,timestamp:new Date().toLocaleTimeString(),mode:a.value?"æ›¿æ¢æ¨¡å¼":"è¿½åŠ æ¨¡å¼"}),m.value.length>10&&(m.value=m.value.slice(0,10))},R=()=>{l.value="",u.value=""},K=d=>{l.value="",u.value="",v.value=d.message,setTimeout(()=>{v.value=""},3e3)},A=d=>{console.log("æäº¤å†…å®¹:",d)};return(d,t)=>(h(),c("div",N,[e("div",j,[t[9]||(t[9]=e("h4",{style:{margin:"0 0 12px 0"}},"ç™¾åº¦è¯­éŸ³è¯†åˆ«é…ç½®",-1)),e("div",H,[e("div",null,[t[5]||(t[5]=e("label",{style:{display:"block","margin-bottom":"4px","font-size":"14px"}},"API Key:",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>s.value=i),type:"text",placeholder:"è¯·è¾“å…¥ç™¾åº¦ API Key",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px"}},null,512),[[b,s.value]])]),e("div",null,[t[6]||(t[6]=e("label",{style:{display:"block","margin-bottom":"4px","font-size":"14px"}},"Secret Key:",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>o.value=i),type:"password",placeholder:"è¯·è¾“å…¥ç™¾åº¦ Secret Key",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px"}},null,512),[[b,o.value]])])]),e("div",L,[e("label",O,[g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>a.value=i),type:"checkbox"},null,512),[[w,a.value]]),t[7]||(t[7]=k(" æ›¿æ¢æ¨¡å¼ (å¦åˆ™ä¸ºè¿½åŠ æ¨¡å¼) ",-1))]),e("label",$,[g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>n.value=i),type:"checkbox"},null,512),[[w,n.value]]),t[8]||(t[8]=k(" ä½¿ç”¨æ¨¡æ‹Ÿæ¼”ç¤º (æ— éœ€çœŸå® API Key) ",-1))])])]),l.value?(h(),c("div",W,[e("div",G,f(l.value),1),u.value?(h(),c("div",J," å®æ—¶è¯†åˆ«: "+f(u.value),1)):y("",!0)])):y("",!0),v.value?(h(),c("div",q,[t[10]||(t[10]=e("div",{style:{"font-weight":"500",color:"#ff4d4f"}},"é”™è¯¯ä¿¡æ¯",-1)),e("div",Q,f(v.value),1)])):y("",!0),e("div",null,[t[11]||(t[11]=e("h4",null,"è‡ªå®šä¹‰è¯­éŸ³è¯†åˆ«è¾“å…¥æ¡†",-1)),V(P(z),{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=i=>r.value=i),mode:"single",allowSpeech:!0,speech:S.value,placeholder:"ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹è¯­éŸ³è¾“å…¥ï¼Œæˆ–ç›´æ¥é”®ç›˜è¾“å…¥...",onSpeechStart:T,onSpeechInterim:_,onSpeechFinal:E,onSpeechEnd:R,onSpeechError:K,onSubmit:A},null,8,["modelValue","speech"])]),m.value.length>0?(h(),c("div",X,[t[12]||(t[12]=e("h4",{style:{margin:"0 0 12px 0"}},"è¯†åˆ«å†å²",-1)),e("div",Y,[(h(!0),c(M,null,U(m.value,(i,C)=>(h(),c("div",{key:C,style:{padding:"8px","margin-bottom":"8px",background:"white","border-radius":"4px","border-left":"3px solid #52c41a"}},[e("div",Z,f(i.timestamp)+" - "+f(i.mode),1),e("div",null,f(i.text),1)]))),128))])])):y("",!0),t[13]||(t[13]=e("div",{style:{padding:"16px",background:"#fffbe6","border-radius":"8px","border-left":"4px solid #faad14"}},[e("h4",{style:{margin:"0 0 8px 0",color:"#fa8c16"}},"ä½¿ç”¨è¯´æ˜"),e("ul",{style:{margin:"0","padding-left":"20px",color:"#666"}},[e("li",null,"å¦‚éœ€ä½¿ç”¨çœŸå®çš„ç™¾åº¦è¯­éŸ³è¯†åˆ«ï¼Œè¯·åœ¨ä¸Šæ–¹è¾“å…¥æœ‰æ•ˆçš„ API Key å’Œ Secret Key"),e("li",null,'å‹¾é€‰"ä½¿ç”¨æ¨¡æ‹Ÿæ¼”ç¤º"å¯ä»¥ä½“éªŒåŠŸèƒ½æµç¨‹ï¼Œæ— éœ€çœŸå® API é…ç½®'),e("li",null,"æ›¿æ¢æ¨¡å¼ï¼šæ¯æ¬¡è¯­éŸ³è¯†åˆ«ä¼šè¦†ç›–è¾“å…¥æ¡†å†…å®¹"),e("li",null,"è¿½åŠ æ¨¡å¼ï¼šè¯­éŸ³è¯†åˆ«ç»“æœä¼šè¿½åŠ åˆ°ç°æœ‰å†…å®¹åé¢"),e("li",null,"æ”¯æŒé”®ç›˜å’Œè¯­éŸ³æ··åˆè¾“å…¥")])],-1))]))}});export{se as default};
