import{d as E,h as S,c as r,e as g,o as u,j as a,n as T,t as v,_ as R,p as s,a0 as d,af as L,G as Y,ag as N,w as j,k as z,F,B as G,a as O}from"./framework.CdlzW3Za.js";import{w as $}from"./theme.C_-hLVRq.js";import{M as A}from"./speechHandlers.BnEXGotK.js";const W="/tiny-robot/alpha/assets/wave.C1Gw4r5M.webp",q={key:0,class:"mobile-voice-overlay"},J=E({__name:"PressToTalkOverlay",props:{visible:{type:Boolean,default:!1},isCanceling:{type:Boolean,default:!1},cancelThreshold:{default:30}},setup(l){const i=l,b=S(()=>i.visible?i.isCanceling?"松开取消":"松开发送，上滑取消":"按住说话");return(p,n)=>l.visible?(u(),r("div",q,[a("div",{class:T(["recording-wave",{active:l.visible}])},[...n[0]||(n[0]=[a("img",{src:W,alt:"Recording Wave",class:"wave-image"},null,-1)])],2),a("div",{class:T(["voice-hint",{cancel:l.isCanceling}])},v(b.value),3),a("button",{class:T(["voice-btn",{recording:l.visible,cancel:l.isCanceling}])},"按住说话",2)])):g("",!0)}}),K=R(J,[["__scopeId","data-v-0ef489cd"]]),Q={style:{display:"flex","flex-direction":"column",gap:"20px"}},X={key:0,style:{padding:"16px",background:"#f9f9f9","border-radius":"8px"}},Z={style:{"max-height":"200px","overflow-y":"auto"}},ee={style:{"font-size":"12px",color:"#999","margin-bottom":"4px"}},te={key:0,style:{color:"#ff4d4f"}},oe={key:1,style:{color:"#00b176"}},x=30,ne=E({__name:"MobilePressToTalk",setup(l){const i=s(),b=s(),p=s(""),n=s(!1),f=s(!1),y=s(0),c=s([]),m=s(!0),h=S(()=>!0),B=new A,D=S(()=>({mode:"custom",customHandler:B,autoReplace:m.value,interimResults:!0,isMobile:h.value,onVoiceButtonClick:async e=>e.isMobile?e.isRecording?(e.speechHandler.stop(),n.value=!1,!0):(n.value=!0,!0):!1})),P=()=>{},I=e=>{e&&(c.value.unshift({text:e,timestamp:new Date().toLocaleTimeString(),mode:m.value?"替换模式":"追加模式",platform:h.value?"移动端":"PC端"}),c.value.length>10&&(c.value.length=10))},U=()=>{},H=e=>{console.log("提交内容:",e)},w=e=>{var t;const o=e instanceof TouchEvent?e.touches[0].clientY:e.clientY;y.value=o,n.value=!0,f.value=!1,(t=i.value)==null||t.startSpeech()},_=e=>{if(!n.value)return;const o=e instanceof TouchEvent?e.touches[0].clientY:e.clientY,t=y.value-o;f.value=t>x},C=e=>{var M,V;if(!n.value)return;const o=e instanceof TouchEvent?e.changedTouches[0].clientY:e.clientY;y.value-o>x?((M=i.value)==null||M.stopSpeech(),c.value.unshift({text:"(录音已取消)",timestamp:new Date().toLocaleTimeString(),mode:m.value?"替换模式":"追加模式",platform:h.value?"移动端":"PC端",canceled:!0})):(c.value.unshift({text:p.value,timestamp:new Date().toLocaleTimeString(),mode:m.value?"替换模式":"追加模式",platform:h.value?"移动端":"PC端",completed:!0}),(V=i.value)==null||V.stopSpeech()),n.value=!1,f.value=!1};return(e,o)=>(u(),r("div",Q,[a("div",null,[o[2]||(o[2]=a("h4",null,"支持移动端按住说话的输入框",-1)),a("div",{class:"sender-container",onTouchmove:d(_,["prevent"]),onTouchend:d(C,["prevent"]),onMousemove:d(_,["prevent"]),onMouseup:d(C,["prevent"])},[L(Y(z($),{ref_key:"senderRef",ref:i,modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=t=>p.value=t),mode:"single",class:"sender",allowSpeech:!0,speech:D.value,placeholder:"点击麦克风按钮开始语音输入...",onSpeechStart:P,onSpeechEnd:I,onSpeechError:U,onSubmit:H},{content:j(()=>[a("div",{style:{width:"100%",display:"flex","justify-content":"center","user-select":"none"},onTouchstart:d(w,["prevent"]),onMousedown:d(w,["prevent"])}," 按住说话 ",32)]),_:1},8,["modelValue","speech"]),[[N,!n.value]]),Y(K,{ref_key:"mobileVoiceUIRef",ref:b,visible:n.value,"onUpdate:visible":o[1]||(o[1]=t=>n.value=t),cancelThreshold:x,isCanceling:f.value},null,8,["visible","isCanceling"])],32)]),c.value.length>0?(u(),r("div",X,[o[3]||(o[3]=a("h4",{style:{margin:"0 0 12px 0"}},"识别历史",-1)),a("div",Z,[(u(!0),r(F,null,G(c.value,(t,k)=>(u(),r("div",{key:k,style:{padding:"8px","margin-bottom":"8px",background:"white","border-radius":"4px","border-left":"3px solid #52c41a"}},[a("div",ee,[O(v(t.timestamp)+" - "+v(t.platform)+" - "+v(t.mode)+" ",1),t.canceled?(u(),r("span",te," - 已取消")):g("",!0),t.completed?(u(),r("span",oe," - 已发送")):g("",!0)]),a("div",null,v(t.text),1)]))),128))])])):g("",!0)]))}}),ie=R(ne,[["__scopeId","data-v-81b258a0"]]);export{ie as default};
