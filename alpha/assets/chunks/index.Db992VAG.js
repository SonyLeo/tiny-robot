var d=(e=>(e.FileTypeNotAllowed="file-type-not-allowed",e.FileSizeExceeded="file-size-exceeded",e.FileCountExceeded="file-count-exceeded",e))(d||{});function E(e,r){if(!r)return!0;const t=r.split(",").map(n=>n.trim());return t.includes("*")?!0:t.some(n=>{if(n.startsWith("."))return e.name.toLowerCase().endsWith(n.toLowerCase());if(n.includes("/*")){const l=n.split("/")[0];return e.type.startsWith(l+"/")}else return e.type===n})}function m(e,r){return e.size<=r}function x(e,r){return e.length<=r}function L(e,r){const{accept:t,multiple:n,maxSize:l,maxFiles:s}=r,o=[],i=[];if(!x(e,s))return{acceptedFiles:o,rejectedFiles:Array.from(e),rejectionReason:{code:d.FileCountExceeded,message:`文件数量不能超过 ${s} 个`}};if(e.forEach(a=>{E(a,t)&&m(a,l)?o.push(a):i.push(a)}),!n&&o.length>1)return{acceptedFiles:[],rejectedFiles:o,rejectionReason:{code:d.FileCountExceeded,message:"只允许上传一个文件"}};if(i.length>0){const a=i.some(u=>!m(u,l)),c=a?d.FileSizeExceeded:d.FileTypeNotAllowed,p=a?`文件大小不能超过 ${l/1024/1024}MB`:`文件类型不匹配 (accept: ${t})`;return{acceptedFiles:o,rejectedFiles:i,rejectionReason:{code:c,message:p}}}return{acceptedFiles:o,rejectedFiles:i,rejectionReason:null}}function D(e){return{accept:e.accept||"*",multiple:e.multiple??!0,maxSize:e.maxSize||1024*1024*10,maxFiles:e.maxFiles||3,onDrop:e.onDrop,onError:e.onError,disabled:e.disabled||!1}}const j={mounted(e,r){let t=0;const{disabled:n,onDraggingChange:l}=r.value;e.__vDropzoneOptions__=D(r.value);const s={handleDragEnter:()=>{n||(t++,t===1&&l(!0,e))},handleDragOver:o=>{n||o.preventDefault()},handleDragLeave:()=>{n||(t--,t===0&&l(!1,null))},handleDrop:o=>{var i;if(n)return;o.preventDefault(),t=0,l(!1,null);const a=(i=o.dataTransfer)==null?void 0:i.files,{onDrop:c,onError:p,accept:u,multiple:f,maxSize:g,maxFiles:h}=e.__vDropzoneOptions__;if(a&&a.length>0){const F=Array.from(a),{acceptedFiles:_,rejectedFiles:z,rejectionReason:v}=L(F,{accept:u,multiple:f,maxSize:g,maxFiles:h});v&&p({files:z,...v}),_.length>0&&c(_)}}};e.__vDropzoneHandlers__=s,e.addEventListener("dragenter",s.handleDragEnter),e.addEventListener("dragover",s.handleDragOver),e.addEventListener("dragleave",s.handleDragLeave),e.addEventListener("drop",s.handleDrop)},updated(e,r){e.__vDropzoneOptions__&&(e.__vDropzoneOptions__=D(r.value))},unmounted(e){e.__vDropzoneHandlers__&&(e.removeEventListener("dragenter",e.__vDropzoneHandlers__.handleDragEnter),e.removeEventListener("dragover",e.__vDropzoneHandlers__.handleDragOver),e.removeEventListener("dragleave",e.__vDropzoneHandlers__.handleDragLeave),e.removeEventListener("drop",e.__vDropzoneHandlers__.handleDrop),delete e.__vDropzoneHandlers__),delete e.__vDropzoneOptions__}};export{j as s};
