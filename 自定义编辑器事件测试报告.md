# 自定义编辑器事件测试记录

## 核心事件测试

### 1. handleBeforeInput 事件测试

#### 1.1 基础文本插入测试

**测试目标**: 验证在空编辑器中插入文本的功能

**测试步骤**:
1. 打开编辑器页面
2. 点击编辑器区域获得焦点
3. 输入英文文本 "Hello World"
4. 观察编辑器内容和数据结构变化

**预期效果**:
- 编辑器中显示 "Hello World"
- 数据结构中新增一个 type 为 'text' 的项目
- 光标定位在文本末尾
- 控制台输出 inputType 为 'insertText'

**测试结果**:
- 编辑器中显示 "Hello World"
- 数据结构中新增一个 type 为 'text' 的项目
- 光标定位在文本末尾
- 控制台输出 inputType 为 'insertText'

**测试结论**:
- 除特定场景下，基础文本插入功能正常工作

**备注**:
- 编辑块为空时，特定操作输入内容后，会在前方创建一个文本块

- 复现方法：
  - 打开编辑器页面
  - 点击编辑器的空编辑块区域获得焦点，点击按键左键，光标保持在编辑块区域
  - 输入英文文本 "Hello World"，
  - 预期效果：编辑块内展示文本信息；
  - 实际效果：在该编辑块前方出现了文本内容

#### 1.2 模板块内容编辑测试

**测试目标**: 验证在模板块中编辑内容的功能

**测试步骤**:
1. 点击任意一个模板块（蓝色边框区域）
2. 输入中文文本 "测试内容"
3. 观察模板块内容变化

**预期效果**:
- 模板块显示输入的中文内容
- 原始数据中对应模板项的 content 字段更新
- 前缀和后缀分隔符保持不变
- 光标定位正确

**测试结果**:
- 模板块显示输入的中文内容
- 原始数据中对应模板项的 content 字段更新
- 前缀和后缀分隔符保持不变
- 光标定位正确

**测试结论**:
- 疑似合成事件(composition) 影响，导致输入内容无法正确显示

- 表现：  
       1. 输入中文时，dom 文本更新，但是 content 属性没有更新  
       2. 清空编辑框内容后，输入文本时，通过查看 dom, 发现 [data-type="prefix"] 节点内容更新


#### 1.3 支持的输入类型详细测试

**测试目标**: 验证编辑器支持的指定 inputType 的正确处理

##### 1.3.1 插入类型测试 (Insert Types)

**insertText 测试**:
- **测试步骤**:
  1. 在编辑器中正常输入字符
  2. 观察控制台输出的 inputType
  3. 验证文本正确插入
- **预期效果**: inputType 为 'insertText'，文本正确插入到光标位置
- **测试结论**: 功能正常

**insertFromPaste 测试**:
- **测试步骤**:
  1. 复制文本到剪贴板
  2. 在编辑器中按 Ctrl+V 粘贴
  3. 观察事件处理
- **预期效果**: inputType 为 'insertFromPaste'，粘贴内容正确处理
- **测试结论**: 功能正常


**insertReplacementText 测试**:
- **测试步骤**:
  1. 输入文本后触发自动更正（如输入 "teh" 自动更正为 "the"）
  2. 鼠标右键选择正确的拼写
  3. 触发拼写纠错
- **预期效果**: inputType 为 'insertReplacementText'，替换文本正确处理
- **测试结论**: 功能正常

##### 1.3.2 删除类型测试 (Delete Types)

**deleteContentBackward 测试**:
- **测试步骤**:
  1. 在文本中间位置按 Backspace 键
  2. 在模板块中按 Backspace 键
  3. 在分隔符位置按 Backspace 键
- **预期效果**:
  - inputType 为 'deleteContentBackward'
  - 光标前一个字符被删除
  - 分隔符处理逻辑正确触发
- **测试结论**: 功能正常

**deleteContentForward 测试**:
- **测试步骤**:
  1. 在文本中间位置按 Delete 键
  2. 在模板块中按 Delete 键
  3. 在分隔符位置按 Delete 键
- **预期效果**:
  - inputType 为 'deleteContentForward'
  - 光标后一个字符被删除
  - 分隔符处理逻辑正确触发
- **测试结论**: 功能正常

**deleteWordBackward 测试**:
- **测试步骤**:
  1. 在单词末尾按 Ctrl+Backspace (Windows) 或 Option+Backspace (Mac)
  2. 在模板块中执行单词删除
  3. 跨越分隔符的单词删除
- **预期效果**:
  - inputType 为 'deleteWordBackward'
  - 整个单词被删除
  - 跨块删除正确处理
- **测试结论**: 功能正常

**deleteWordForward 测试**:
- **测试步骤**:
  1. 在单词开头按 Ctrl+Delete (Windows) 或 Option+Delete (Mac)
  2. 在模板块中执行前向单词删除
  3. 跨越分隔符的单词删除
- **预期效果**:
  - inputType 为 'deleteWordForward'
  - 光标后整个单词被删除
  - 跨块删除正确处理
--- **测试结论**: 功能正常

**deleteSoftLineBackward 测试**:
- **测试步骤**:
  1. 在行中间按 Cmd+Backspace (Mac) 或 Windows+Backspace (Windows)
  2. 在模板块中执行行删除
  3. 跨越多个块的行删除
- **预期效果**:
  - inputType 为 'deleteSoftLineBackward'
  - 光标到行首的内容被删除
  - 多块内容正确处理

**deleteSoftLineForward 测试**:
- **测试步骤**:
  1. 在行中间按 Cmd+Delete (Mac) 或 End+Shift+Delete (Windows)
  2. 在模板块中执行前向行删除
  3. 跨越多个块的行删除
- **预期效果**:
  - inputType 为 'deleteSoftLineForward'
  - 光标到行尾的内容被删除
  - 多块内容正确处理

**deleteByCut 测试**:
- **测试步骤**:
  1. 选中文本后按 Ctrl+X (Windows) 或 Cmd+X (Mac)
  2. 选中跨越多个块的内容后剪切
  3. 选中包含分隔符的内容后剪切
- **预期效果**:
  - inputType 为 'deleteByCut'
  - 选中内容被删除并复制到剪贴板
  - 跨块剪切正确处理
- **测试结论**: 功能正常

##### 1.3.3 综合删除操作测试

**选中删除测试**:
- **测试步骤**:
  1. 选中部分文本后按 Delete/Backspace
  2. 选中跨越多个块的内容后删除
  3. 选中包含分隔符的内容后删除
- **预期效果**:
  - 单字符删除正确
  - 空块被正确清理
  - 分隔符处理逻辑正确
  - 光标定位准确
  - 数据结构保持一致性
- **测试结论**: 跨块删除时，空编辑块被异常清理。其余一切正常

#### 1.4 分隔符处理测试

**测试目标**: 验证零宽字符分隔符的处理逻辑

**测试步骤**:
1. 将光标定位在分隔符左侧（startOffset = 0）
2. 输入文本
3. 将光标定位在分隔符右侧（startOffset = 1）
4. 输入文本
5. 尝试删除分隔符

**预期效果**:
- 在分隔符左侧输入时，文本插入到前一个块或创建新块
- 在分隔符右侧输入时，文本插入到后一个块或创建新块
- 分隔符不能被直接编辑
- Safari 和 Chrome 的行为差异得到正确处理

-**测试结论**:   
左侧输入时，需要键盘光标左移，光标存在问题，文本插入到前一个块；  
右侧输入时，文本插入到后一个块。分隔符不能被直接编辑。

### 2. handleCompositionEnd 事件测试

#### 2.1 中文输入法测试

**测试目标**: 验证中文输入法的兼容性

1. 切换到中文输入法
2. 在编辑器中输入拼音 "nihao"
3. 选择候选词 "你好"
4. 观察 compositionend 事件触发

**预期效果**:
- 输入过程中不触发 beforeinput 事件
- compositionend 事件正确触发
- 最终文本正确插入
- 控制台输出相关事件信息

--**测试结论**: 中文输入法下，compositionend 事件正常触发

### 3. handlePaste 事件测试

#### 3.1 纯文本粘贴测试

**测试目标**: 验证纯文本粘贴功能

**测试步骤**:
1. 复制纯文本内容
2. 在编辑器中粘贴（Ctrl+V）
3. 观察粘贴结果

**预期效果**:
- 文本正确粘贴到光标位置
- 触发 beforeinput 事件，inputType 为 'insertFromPaste'
- 数据结构正确更新

-**测试结论**: 正常表现

### 4. showSelection 功能测试

#### 4.1 选择范围显示测试

**测试目标**: 验证选择范围信息的正确性

**测试步骤**:
1. 在编辑器中选中一段文本
2. 点击 "显示selection" 按钮
3. 查看控制台输出

**预期效果**:
- 控制台正确显示选择范围的开始和结束位置
- startContainer 和 endContainer 信息准确
- startOffset 和 endOffset 数值正确

-**测试结论**: 正常表现

#### 4.2 跨块选择测试

**测试目标**: 验证跨越多个块的选择

**测试步骤**:
1. 选中跨越文本块和模板块的内容
2. 点击 "显示selection" 按钮
3. 分析选择范围信息

**预期效果**:
- 正确识别跨块选择
- 各个容器信息准确
- 偏移量计算正确

-**测试结论**: 正常表现

## 浏览器兼容性测试

### Chrome 浏览器测试 【表现正常】
- 测试所有核心功能
- 验证 getComposedRanges API 支持
- 检查 Shadow DOM 兼容性

### Safari 浏览器测试
- 重点测试 Safari 特殊逻辑分支
- 验证 getComposedRanges 参数差异处理
- 检查分隔符输入行为差异

## InputType 事件验证矩阵

### 输入类型支持验证表

| InputType | 触发方式 | 测试场景 | 验证要点 | 状态 |
|-----------|----------|----------|----------|------|
| insertText | 键盘输入字符 | 普通文本输入 | 文本正确插入，光标定位 | ✅ |
| insertFromPaste | Ctrl+V 粘贴 | 粘贴纯文本/富文本 | 内容正确处理，格式清理 | ✅ |
| insertReplacementText | 自动更正/建议 | 拼写纠错，输入建议 | 替换文本正确 | ✅ |
| deleteContentBackward | Backspace 键 | 单字符删除 | 字符删除，光标移动 | ✅ |
| deleteContentForward | Delete 键 | 前向字符删除 | 字符删除，光标保持 | ✅ |
| deleteWordBackward | Ctrl+Backspace | 单词删除 | 整词删除，边界处理 | ✅ |
| deleteWordForward | Ctrl+Delete | 前向单词删除 | 整词删除，边界处理 | ✅ |
| deleteSoftLineBackward | Cmd+Backspace | 行删除 | 行内容删除，多块处理 | ⏳ |
| deleteSoftLineForward | Cmd+Delete | 前向行删除 | 行内容删除，多块处理 | ⏳ |
| deleteByCut | Ctrl+X 剪切 | 选中内容剪切 | 内容删除，剪贴板复制 | ✅ |

### 特殊场景测试矩阵

| 场景类型 | 测试内容 | 涉及的 InputType | 验证重点 |
|----------|----------|------------------|----------|
| 分隔符处理 | 在零宽字符位置操作 | 所有删除类型 | 光标移动逻辑，块切换 |
| 跨块操作 | 选择跨越多个块 | deleteWordBackward/Forward | 多块内容处理 |
| 空块清理 | 删除导致块为空 | 所有删除类型 | 数据结构清理 |
| 浏览器差异 | Safari vs Chrome 行为 | insertText | 平台特定逻辑 |
| 输入法兼容 | 中文输入法 | insertText | 组合输入处理 |

## 边界情况测试

### 1. 空内容处理
- 编辑器完全为空时的输入
- 所有块都被删除后的状态
- 数据结构的自动清理

-**结论**：表现正常，数据结构自动清理，光标正常移动

### 2. 特殊字符处理
- 零宽字符的正确处理

-- **结论**：零宽字符被正确识别和处理，光标移动逻辑正常

## 测试结果记录

### 测试
- **测试结果**: ✅通过 / ❌失败 / ⚠️部分通过
- **实际表现**: [详细描述]

## 已知问题和限制

1. **合成事件兼容性**: compositionend 事件处理可能需要完善
2. **左边界光标异常**: 浏览器默认行为
3. **deleteSoftLineBackward/deleteSoftLineForward**: 没有按出来
4. **选中删除区块时**：特殊情况下触发

## InputTypes 数组测试覆盖

主要对下述 inputTypes 数组，进行测试和验证

```javascript
const inputTypes = [
  'insertText',           // ✅ 已覆盖 - 基础文本输入测试
  'insertFromPaste',      // ✅ 已覆盖 - 粘贴功能测试
  'insertReplacementText', // ✅ 已覆盖 - 自动更正测试
  'deleteContentBackward', // ✅ 已覆盖 - Backspace 删除测试
  'deleteContentForward',  // ✅ 已覆盖 - Delete 删除测试
  'deleteWordBackward',    // ✅ 已覆盖 - 单词后向删除测试
  'deleteWordForward',     // ✅ 已覆盖 - 单词前向删除测试
  'deleteSoftLineBackward', // ✅ 已覆盖 - 行后向删除测试
  'deleteSoftLineForward',  // ✅ 已覆盖 - 行前向删除测试
  'deleteByCut',           // ✅ 已覆盖 - 剪切删除测试
]
```